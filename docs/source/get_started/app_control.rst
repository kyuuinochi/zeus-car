.. _play_app_control:

APPによる制御
=========================

Zeus Carをモバイルデバイスから制御するには、デバイスにAPP（SunFounder Controller）をダウンロードし、Zeus CarのLANに接続し、APP上で独自のコントローラーを作成する必要があります。


.. image:: img/app_control.gif


クイックガイド
---------------------


#. **APP Store(iOS)** または **Google Play(Android)** から `SunFounder Controller <https://docs.sunfounder.com/projects/sf-controller/en/latest/>`_ をインストールします。

#. Zeus Carを起動しましょう。

    * 初めて使用する場合やバッテリーケーブルを抜いた場合、Zeus Car Shieldは過放電保護回路を作動させます。
    * したがって、約5秒間Type-Cケーブルを接続する必要があります。

            .. image:: img/zeus_charge.jpg

    * 電源インジケータが点灯した場合、保護状態が解除されたことを意味します。この時、バッテリーインジケータを確認し、両方のインジケータが消灯している場合は、Type-Cケーブルを接続してバッテリーを充電してください。

        .. image:: img/zeus_power.jpg

    * この時点で、Zeus Carは正常に起動し、車の下のRGB LEDストリップがシアン色に点灯します。

        .. image:: img/zeus_car.jpg

    * 黄色いライトが点灯した場合、起動に失敗したことを意味します。この場合、ESP32-CAMがArduinoボードと通信できるように、このスイッチを **Runモード** （図の右）に切り替える必要があります。

        .. image:: img/zeus_run.jpg
    
    * Arduinoボードのコードを再度実行させるため、 **Reset** ボタンを押してください。

        .. image:: img/zeus_reset_button.jpg


#. ``Zeus_Car`` WLANに接続します。

    今、Zeus Carによってブロードキャストされるローカルエリアネットワーク（LAN）にモバイルデバイスを接続します。このようにして、モバイルデバイスとZeus Carが同じネットワーク上になり、アプリとZeus Car間の通信が容易になります。

    * 携帯電話（タブレット）のWLANで ``Zeus_Car`` を見つけ、パスワード ``12345678`` を入力して接続します。

    .. image:: img/app_wlan.png

    * デフォルトの接続モードはAPモードです。したがって、接続後、このWLANネットワークにインターネットへのアクセスがないというプロンプトが表示されるので、接続を続けてください。

    .. image:: img/app_no_internet.png

#. コントローラーを作成します。

    * SunFounder Controller上でコントローラーを追加するには、**+** アイコンをクリックします。

        .. image:: img/app1.png

    * 一部の製品にはプリセットコントローラーが用意されていますが、ここでは **Zeus Car** を選びます。

        .. image:: img/app_preset.png

    * 名前を付けて、確認をクリックします。

        .. image:: img/app_name.png
    
    * コントローラーの内部に移動し、すでにいくつかのウィジェットが設定されています。右上の |app_save| ボタンをクリックします。

        .. image:: img/app_edit.png

#. コントローラーに接続し、実行します。

    * 今、 |app_connect| ボタンを使用して、SunFounder ControllerをZeus Carに接続し、通信を開始します。数秒待つと ``Zeus_Car(IP)`` が表示されますので、それをクリックして接続します。

        .. image:: img/app_auto_connect.png

        .. note::
            「Zeus_Car」にWi-Fiが接続されていることを確認してください。長時間上記のメッセージが表示されない場合は特に注意が必要です。

* "Connected Successfully"のメッセージが表示されたら、 |app_run| ボタンをクリックします。するとアプリにカメラの映像が表示され、Zeus Carをこれらのウィジェットで操作することができます。

    .. image:: img/app_run.png

* 以下はウィジェットの機能一覧です。

    * :ref:`app_compass_cali`: コンパスのキャリブレーションをオンにします。
    * **Stop(F)**: カーのすべての動きを停止します。
    * **Set Heading(I)**: 手で車を一方向に向け、このウィジェットをクリックすると、その方向を車の前方として設定します。これにより、他のウィジェットでゆっくりと車をその方向に回転させる代わりに、素早く方向を指定することができます。
    * :ref:`app_drift`: ドリフト機能をアクティベートします。
    * :ref:`app_move`: すべての方向に車を移動させます。
    * :ref:`app_speech_control`: 音声制御モードに切り替えます。
    * :ref:`app_line_track`: ライン追跡モードに切り替えます。
    * :ref:`app_follow`: フォローモードに切り替えます。
    * :ref:`app_avoid`: 障害物回避モードに切り替えます。
    * :ref:`app_rotate_drift`: 頭部の方向を制御するために使用されます。

.. _app_compass_cali:

Calibration(E)
--------------------------

|app_cali_e| ボタンをクリックしてコンパスのキャリブレーションをオンにします。

Zeusカーを地上に置きます。コンパスのキャリブレーションをオンにすると、車は反時計回りに回転を開始し、約1分で停止します。2分以上回転する場合は、こちらの磁場が複雑です。場所を変更して再度キャリブレーションしてください。

.. _app_drift:

Drift Enable(J)
---------------------

|app_drift_j| ボタンをクリックして、ドリフト機能を有効にします。

* |app_rotate_q| ウィジェットを反時計回りにスライドすると、Zeus Carが右にドリフトします。手を離すと、車は現在の位置で停止します。

    .. image:: img/zeus_drift_left.jpg
        :width: 600
        :align: center

* 同様に、 |app_rotate_q| ウィジェットを時計回りにスライドすると、Zeus Carは左にドリフトし、現在の位置で停止します。

    .. image:: img/zeus_drift_right.jpg
        :width: 600
        :align: center

.. _app_move:

Move in All Directions(K)
----------------------------------

|app_move_k| ウィジェットをスワイプすると、Zeus Carは適切な方向に移動します。

.. image:: img/joystick_move.png
    :align: center

一度スライドすると車が動きますので、常に手を離さない限り、車は移動し続けます。

.. image:: img/zeus_move.jpg

.. _app_speech_control:

Speech(M)
-------------------

.. warning::
    Androidデバイスでは音声制御機能を使用することはできません。音声制御機能を使用するためには、Androidモバイルデバイスをインターネットに接続し、Googleサービスコンポーネントをインストールする必要があります。
    
    iOSデバイスはオフライン音声認識エンジンを使用するため、ネットワーク接続は不要です。APモードとSTAモードの接続がともに利用可能です。

Zeus CarはSunFounder Controller内での音声による操作も可能です。モバイルデバイスに指示を伝えると、Zeus Carは指定されたアクションを実行します。

|app_speech_m| ウィジェットを長押しして、以下のコマンドのいずれかを言ってみてください。

* ``stop``: 車のすべての動きを停止できます。
* ``pasue``: Stopと基本的には同じ機能ですが、車の頭が元の設定方向を向いていない場合、設定方向にゆっくり移動します。
* ``forward``
* ``backward``
* ``left forward``
* ``left backward``
* ``right forward``
* ``right backward``
* ``move left``
* ``move right``

    上記の8つのコマンドを車が受信した後、 ``stop`` または ``pasue`` のコマンドを受信するまで、対応する方向に移動し続けます。

    .. image:: img/zeus_move.jpg

* ``turn left``: このコマンドを使用すると、車は本体を中心に45°左に回転し、前の状態に基づいて前進するか停止します。前の状態が停止の場合は、45°左に回転した後に停止します；前進の場合は、回転した後に前進します。

    .. image:: img/zeus_turn_left.jpg
        :width: 600
        :align: center

* ``turn right``: このコマンドを使用すると、車は本体を中心に45°右に回転し、前の状態によって前進するか停止します。

    .. image:: img/zeus_turn_right.jpg
        :width: 600
        :align: center

.. _app_line_track:

Line(N)
--------------

|app_line_n| ウィジェットをクリックしてライン追跡モードに切り替えます。

Zeus Carには、移動の方向を常に向いているモードと、頭が固定の方向を向いているモードの、2つのライン追跡モードがあります。ここでは、後者が選択されています。

1. 3cm幅のラインを貼る

    Omniグレースケールモジュールには8つのセンサーがあり、各センサー間の距離は2cmから3cmです。ブラックラインを同時に検出するためには、2つのセンサーが必要です。したがって、貼るラインは少なくとも3cmの幅が必要であり、曲がる角度は90°未満であってはなりません。

    .. image:: img/map.png
        :width: 800

2. Omniグレースケールモジュールをキャリブレートする。

    各サブフロアは異なるグレースケール値を持っているため、工場で設定された閾値は現在の環境に適していない場合があります。そのため、使用する前にこのモジュールをキャリブレートする必要があります。床の色が大きく変わった場合は、キャリブレーションを再度行うことを推奨します。

    * Zeus Carを白い表面に置き、灰色のセンサーの光がちょうど点灯するまでポテンショメーターを回します。

        .. image:: img/zeus_line_calibration.jpg

    * それから、二つのグレースケールセンサーを、ブラックラインと白い表面の間にちょうど配置し、信号インジケータがちょうど消えるまでゆっくりとポテンショメーターを回します。

        .. image:: img/zeus_line_calibration1.jpg

    * グレースケールセンサーの光が、ブラックラインと白い表面の間にあるときに消灯し、白い表面にあるときに点灯することを確認するために、ブラックラインと白い表面の上を何度も動かすことができます。これは、モジュールが正常にキャリブレーションされたことを示しています。

3. Zeus Carを貼ったラインの上に置き、 |app_line_n| ウィジェットをクリックすると、ラインを追跡します。

4. Omniグレースケールモジュールの環境要件が高いため、追跡効果が満足できない場合（脱線）は、何度もキャリブレートすることを推奨します。

.. _app_follow:

Follow(O)
------------

|app_follow_o| ウィジェットをクリックして、フォローモードに切り替えます。

超音波センサーは前方（20 cm）の障害物を検出し、それらを追尾します。これら二つの障害物回避モジュールは車が左または右に追尾することを可能にしますが、使用前に（15cm）でキャリブレートする必要があります。

1. IR障害物回避モジュールをキャリブレートする。

    * IR障害物回避モジュールから約15cm離れた場所に障害物を置きます。
    * モジュールには2つのポテンショメータがあります。一つは送信電力を調整するためのもの、もう一つは送信周波数を調整するためのものです。これらのポテンショメータを調整することで、検出距離を調整することができます。
    * その後、ポテンショメータを調整し、15cmでモジュールの信号灯が点灯する場合は調整が成功していると言えます。そうでない場合は、もう一つのポテンショメータを調整します。

        .. image:: img/zeus_ir_avoid.jpg

    * 同じ方法で他の障害物回避モジュールをキャリブレートします。

2. Zeus車をテーブルや地面に置き、あなたの手や他の障害物を追跡させます。

.. _app_avoid:

Avoid(p)
------------------------

障害物回避モードに入る場合は、 |app_avoid_p| ウィジェットをクリックしてください。ただし、2つの障害物回避モジュールをキャリブレートする前に、:ref:`app_follow` を参照してください。

* Zeus車は前進します。
* 超音波モジュールは前方の障害物を検出します。検出された場合、車は左に回転します。
* 左の障害物回避モジュールが障害物を検出すると、車は右に回転し、右の障害物回避モジュールが障害物を検出すると、車は左に回転します。

.. _app_rotate_drift:

Control the Drection(Q)
-------------------------------

* |app_drift_j| ボタンがオンの場合、 |app_rotate_q| ウィジェットはZeus Carを左右にドリフトさせるために使用されます。

* |app_drift_j| ウィジェットがオフの場合、 |app_rotate_q| ウィジェットは車の頭の方向を制御するために使用されます。

    * |app_rotate_q| ウィジェットを反時計回りにスライドすると、車も反時計回りに回転します。手を離すと、車の頭は元の方向に戻ります。

    .. image:: img/zeus_turn_left.jpg
        :width: 600
        :align: center

    * 同様に、 |app_rotate_q| ウィジェットで車は時計回りに回転し、手を放すと元の方向に戻ります。

    .. image:: img/zeus_turn_right.jpg
        :width: 600
        :align: center

